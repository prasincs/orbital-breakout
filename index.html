<!-- index.html -->
<!DOCTYPE html>
<html>
<head>
  <title>Orbit Breakout</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/p5.js/1.4.2/p5.min.js"></script>
  <style>
    body { margin: 0; display: flex; justify-content: center; align-items: center; height: 100vh; background-color: #1a1a1a; }
    canvas { border: 2px solid #fff; }
  </style>
</head>
<body>
  <script>
    let paddle;
    let ball;
    let bricks = [];
    let orbitingBalls = [];
    let score = 0;
    let turns = 0;
    let brickHitPoints = { green: 34, pink: 26, blue: 14 };

    function setup() {
      createCanvas(600, 400);
      paddle = new Paddle();
      ball = new Ball();
      initializeBricks();
    }

    function draw() {
      background(30);
      paddle.show();
      paddle.move();
      ball.show();
      ball.move();
      ball.bounce();
      for (let i = orbitingBalls.length - 1; i >= 0; i--) {
        orbitingBalls[i].show();
        orbitingBalls[i].move();
        orbitingBalls[i].bounce();
      }
      for (let i = bricks.length - 1; i >= 0; i--) {
        bricks[i].show();
        if (ball.hits(bricks[i]) || orbitingBalls.some(ob => ob.hits(bricks[i]))) {
          bricks[i].hit();
          if (bricks[i].hp <= 0) bricks.splice(i, 1);
          score += 10;
          turns++;
          if (turns % 5 === 0 && turns > 0) addOrbitingBall();
        }
      }
      fill(255);
      textSize(16);
      text(`Score: ${score}`, 10, 20);
      text(`Turns: ${turns}`, 10, 40);
    }

    function initializeBricks() {
      let types = ['green', 'pink', 'blue'];
      for (let x = 50; x < width - 50; x += 60) {
        for (let y = 50; y < 150; y += 30) {
          let type = random(types);
          bricks.push(new Brick(x, y, brickHitPoints[type], type));
        }
      }
    }

    function addOrbitingBall() {
      orbitingBalls.push(new Ball(ball.x, ball.y, true));
    }

    class Paddle {
      constructor() {
        this.w = 80;
        this.h = 10;
        this.x = width / 2 - this.w / 2;
        this.y = height - 30;
      }
      show() { fill(255); rect(this.x, this.y, this.w, this.h); }
      move() {
        if (keyIsDown(LEFT_ARROW) && this.x > 0) this.x -= 5;
        if (keyIsDown(RIGHT_ARROW) && this.x < width - this.w) this.x += 5;
      }
    }

    class Ball {
      constructor(x = width / 2, y = height / 2, orbiting = false) {
        this.x = x;
        this.y = y;
        this.r = 10;
        this.dx = orbiting ? random(-2, 2) : 4;
        this.dy = orbiting ? random(-2, 2) : -4;
        this.orbiting = orbiting;
      }
      show() { fill(255, 0, 255); ellipse(this.x, this.y, this.r * 2); }
      move() {
        this.x += this.dx;
        this.y += this.dy;
        if (this.orbiting) {
          let angle = atan2(ball.y - this.y, ball.x - this.x);
          this.x = ball.x + cos(angle) * 30;
          this.y = ball.y + sin(angle) * 30;
        }
      }
      bounce() {
        if (this.x <= 0 || this.x >= width) this.dx *= -1;
        if (this.y <= 0) this.dy *= -1;
        if (this.y >= height - paddle.h && this.x > paddle.x && this.x < paddle.x + paddle.w) {
          this.dy *= -1;
          // Adjust angle based on paddle position
          let relativeIntersect = (this.x - (paddle.x + paddle.w / 2)) / (paddle.w / 2);
          this.dx = 4 * relativeIntersect;
        }
        if (this.y > height) {
          if (!this.orbiting) ball = new Ball();
          else orbitingBalls = orbitingBalls.filter(b => b !== this);
        }
      }
      hits(brick) {
        return this.x > brick.x && this.x < brick.x + brick.w && this.y > brick.y && this.y < brick.y + brick.h;
      }
    }

    class Brick {
      constructor(x, y, hp, type) {
        this.x = x;
        this.y = y;
        this.w = 50;
        this.h = 20;
        this.hp = hp;
        this.type = type;
      }
      show() {
        if (this.type === 'green') fill(0, 255, 0);
        else if (this.type === 'pink') fill(255, 0, 255);
        else fill(0, 0, 255);
        rect(this.x, this.y, this.w, this.h);
        fill(255);
        textSize(12);
        text(this.hp, this.x + this.w / 2, this.y + this.h / 2);
      }
      hit() { this.hp--; }
    }
  </script>
</body>
</html>